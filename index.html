<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>🏛 TyetaPay Pro</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  *{margin:0;padding:0;box-sizing:border-box;font-family:"Poppins",sans-serif;}
  body{
    background:linear-gradient(135deg,#001f3f,#0074D9);
    height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
    color:white;
  }
  .overlay{position:absolute;top:0;left:0;width:100%;height:100%;backdrop-filter:blur(10px);background:rgba(0,0,0,0.4);}
  .app{position:relative;z-index:1;width:100%;max-width:430px;background:rgba(255,255,255,0.08);border-radius:20px;box-shadow:0 0 40px rgba(0,255,255,0.3);overflow:hidden;backdrop-filter:blur(20px);}
  header{background:rgba(0,0,0,0.3);color:#00bfff;text-align:center;padding:20px 0;font-size:26px;font-weight:700;text-shadow:0 0 10px #00bfff;}
  main{padding:25px;}
  .hidden{display:none;}
  label{font-size:14px;opacity:0.9;}
  input{width:100%;padding:10px;margin:6px 0;border:none;border-radius:8px;background:rgba(255,255,255,0.15);color:white;outline:none;}
  input::placeholder{color:#ccc;}
  button{width:100%;padding:12px;border:none;border-radius:8px;background:#00bfff;color:white;font-size:16px;font-weight:600;cursor:pointer;transition:0.3s;}
  button:hover{background:#0095cc;box-shadow:0 0 10px #00bfff;}
  .center{text-align:center;}
  .toggle{position:absolute;top:10px;right:10px;cursor:pointer;background:#00bfff;color:white;padding:5px 10px;border-radius:8px;font-size:12px;}
  .dark-mode{background:linear-gradient(135deg,#000,#003);color:white;}
  #notif{position:fixed;top:20px;right:20px;padding:10px 20px;background:#00bfff;color:white;border-radius:8px;display:none;animation:fadeIn 0.5s;}
  @keyframes fadeIn{from{opacity:0;transform:translateY(-10px);}to{opacity:1;transform:translateY(0);}}
</style>
</head>
<body>
<div class="overlay"></div>
<div id="notif"></div>

<div class="app" id="app">
  <div class="toggle" onclick="toggleMode()">🌙 Mode</div>
  <header>🏛 TyetaPay Pro</header>

  <!-- LOGIN -->
  <main id="login-page">
    <h2 class="center">Masuk ke TyetaPay</h2><br>
    <label>Email</label>
    <input type="email" id="login-email" placeholder="Masukkan email">
    <label>Password</label>
    <input type="password" id="login-password" placeholder="Masukkan password">
    <button onclick="login()">Masuk</button>
    <p class="center">Belum punya akun? <a href="#" onclick="showRegister()">Daftar</a></p>
  </main>

  <!-- REGISTER -->
  <main id="register-page" class="hidden">
    <h2 class="center">Daftar TyetaPay</h2><br>
    <label>Nama</label>
    <input type="text" id="reg-name" placeholder="Masukkan nama">
    <label>Email</label>
    <input type="email" id="reg-email" placeholder="Masukkan email">
    <label>Password</label>
    <input type="password" id="reg-password" placeholder="Masukkan password">
    <label>Buat PIN (4 digit)</label>
    <input type="number" id="reg-pin" placeholder="1234">
    <button onclick="register()">Daftar</button>
    <p class="center"><a href="#" onclick="showLogin()">Sudah punya akun? Masuk</a></p>
  </main>

<!-- DASHBOARD -->
  <main id="dashboard-page" class="hidden">
    <h2 class="center" id="user-name"></h2>
    <p class="center">Saldo kamu:</p>
    <p class="center balance" id="user-balance">Rp 0</p>

    <div class="actions center">
      <button onclick="topup()">💰 Isi Saldo</button>
      <button onclick="withdraw()">🏦 Tarik Saldo</button>
      <button onclick="transfer()">💸 Transfer</button>
    </div><br>

    <button onclick="showShop()">🛍️ Buka Toko</button>
    <button onclick="showStats()">📊 Statistik</button>
    <button onclick="exportHistory()">⬇️ Export Riwayat</button>
    <button onclick="logout()">🚪 Keluar</button>

    <h3>📜 Riwayat Transaksi</h3>
    <div id="transaction-list"></div><br>

    <iframe id="map" src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3952.70629331438!2d110.366353!3d-7.822840!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0x0!2zN8KwNDknMjIuMiJTIDExMMKwMjInMDAuOSJF!5e0!3m2!1sid!2sid!4v1700000000000" allowfullscreen></iframe>
    <br><button onclick="chatWA()">💬 Hubungi Admin</button>
  </main>

  <!-- TOKO -->
  <main id="shop-page" class="hidden">
    <h2 class="center">🛍️ Toko TyetaPay</h2><br>
    <div id="shop-list"></div>
    <button onclick="showDashboard()">⬅️ Kembali</button>
  </main>

  <!-- STATISTIK -->
  <main id="stats-page" class="hidden">
    <h2 class="center">📊 Statistik Transaksi</h2>
    <canvas id="chart"></canvas><br>
    <button onclick="showDashboard()">⬅️ Kembali</button>
  </main>
</div>

<script>
const users = JSON.parse(localStorage.getItem('tyetapay_users')||'{}');
let currentUser = JSON.parse(localStorage.getItem('tyetapay_current')||'null');
let dark=false;

function toggleMode(){
  dark=!dark;
  document.body.classList.toggle('dark-mode',dark);
}

function showLogin(){hideAll();document.getElementById('login-page').classList.remove('hidden');}
function showRegister(){hideAll();document.getElementById('register-page').classList.remove('hidden');}
function showDashboard(){hideAll();document.getElementById('dashboard-page').classList.remove('hidden');loadDashboard();}
function showShop(){hideAll();document.getElementById('shop-page').classList.remove('hidden');loadShop();}
function showStats(){hideAll();document.getElementById('stats-page').classList.remove('hidden');loadChart();}
function hideAll(){['login-page','register-page','dashboard-page','shop-page','stats-page'].forEach(id=>document.getElementById(id).classList.add('hidden'));}

function notify(msg){const n=document.getElementById('notif');n.innerText=msg;n.style.display='block';setTimeout(()=>n.style.display='none',2500);}
function save(){localStorage.setItem('tyetapay_users',JSON.stringify(users));localStorage.setItem('tyetapay_current',JSON.stringify(currentUser));}

function register(){
  const name=document.getElementById('reg-name').value.trim();
  const email=document.getElementById('reg-email').value.trim();
  const pass=document.getElementById('reg-password').value.trim();
  const pin=document.getElementById('reg-pin').value.trim();
  if(!name||!email||!pass||pin.length!==4)return alert('Isi semua kolom dengan benar!');
  if(users[email])return alert('Email sudah terdaftar!');
  users[email]={name,email,pass,pin,balance:0,bonus:false,history:[]};
  save();
  alert('Pendaftaran berhasil!');
  showLogin();
}

function login(){
  const email=document.getElementById('login-email').value.trim();
  const pass=document.getElementById('login-password').value.trim();
  if(!users[email])return alert('Akun tidak ditemukan!');
  if(users[email].pass!==pass)return alert('Password salah!');
  currentUser=users[email];
  save();
  showDashboard();
}

function logout(){
  localStorage.removeItem('tyetapay_current');
  currentUser=null;
  showLogin();
}

function loadDashboard(){
  document.getElementById('user-name').innerText='Halo, '+currentUser.name;
  document.getElementById('user-balance').innerText='Rp '+currentUser.balance.toLocaleString();
  const list=document.getElementById('transaction-list');
  list.innerHTML=currentUser.history.map(h=>`<div class='transaction'>${h}</div>`).join('');
}

function topup(){
  let a=parseInt(prompt('Masukkan jumlah top up (Rp)'));
  if(isNaN(a)||a<=0)return alert('Jumlah tidak valid!');
  if(!currentUser.bonus){a+=10000;notify('Bonus Rp10.000 top-up pertama!');currentUser.bonus=true;}
  currentUser.balance+=a;
  currentUser.history.unshift(`+ Rp${a.toLocaleString()} (Top Up)`);
  save();loadDashboard();notify('Top up berhasil!');
}

function withdraw(){
  const pin=prompt('Masukkan PIN');if(pin!==currentUser.pin)return alert('PIN salah!');
  let a=parseInt(prompt('Jumlah tarik saldo (Rp)'));
  if(isNaN(a)||a<=0||a>currentUser.balance)return alert('Jumlah tidak valid!');
  currentUser.balance-=a;
  currentUser.history.unshift(`- Rp${a.toLocaleString()} (Withdraw)`);
  save();loadDashboard();notify('Penarikan berhasil!');
}

function transfer(){
  const to=prompt('Masukkan email tujuan');
  if(!users[to])return alert('Tujuan tidak ditemukan!');
  const pin=prompt('Masukkan PIN');if(pin!==currentUser.pin)return alert('PIN salah!');
  const amt=parseInt(prompt('Jumlah transfer (Rp)'));
  if(isNaN(amt)||amt<=0||amt>currentUser.balance)return alert('Jumlah tidak valid!');
  currentUser.balance-=amt;users[to].balance+=amt;
  currentUser.history.unshift(`- Rp${amt.toLocaleString()} ke ${to}`);
  users[to].history.unshift(`+ Rp${amt.toLocaleString()} dari ${currentUser.email}`);
  save();loadDashboard();notify('Transfer berhasil!');
}

function chatWA(){
  window.open('https://wa.me/6289603266259?text=Halo%20Admin%20TyetaPay%2C%20saya%20butuh%20bantuan.','_blank');
}

function loadShop(){
  const shop=[
    {name:'Top Up Game',price:10000},
    {name:'Pulsa 20rb',price:20000},
    {name:'Saldo E-Wallet',price:50000},
    {name:'Voucher Premium',price:75000}
  ];
  document.getElementById('shop-list').innerHTML=shop.map(p=>`
    <div class='transaction'>
      <b>${p.name}</b><br>Harga: Rp${p.price.toLocaleString()}<br>
      <button onclick="buy('${p.name}',${p.price})">Beli</button>
    </div>
  `).join('');
}

function buy(name,price){
  if(currentUser.balance<price)return alert('Saldo tidak cukup!');
  currentUser.balance-=price;
  currentUser.history.unshift(`- Rp${price.toLocaleString()} (Beli ${name})`);
  save();loadDashboard();notify('Pembelian berhasil!');
}

function loadChart(){
  const ctx=document.getElementById('chart').getContext('2d');
  const masuk=currentUser.history.filter(h=>h.startsWith('+')).length;
  const keluar=currentUser.history.filter(h=>h.startsWith('-')).length;
  new Chart(ctx,{
    type:'doughnut',
    data:{
      labels:['Pemasukan','Pengeluaran'],
      datasets:[{
        data:[masuk,keluar],
        backgroundColor:['#00bfff','#ff5555']
      }]
    },
    options:{plugins:{legend:{labels:{color:'#fff'}}}}
  });
}

function exportHistory(){
  const content=currentUser.history.join('\\n');
  const blob=new Blob([content],{type:'text/plain'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');
  a.href=url;a.download='Riwayat_TyetaPay.txt';
  a.click();
  URL.revokeObjectURL(url);
  notify('Riwayat diekspor!');
}

if(currentUser)showDashboard();else showLogin();
</script>

</body>
</html>
